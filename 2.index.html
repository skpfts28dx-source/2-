
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç—…å¨‡ç”·ä¸»è§£æ•‘ç³»ç»Ÿ - å¿«ç©¿æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
        }
        
        body {
            background-color: #0f0f1a;
            color: #f0f0f0;
            overflow-x: hidden;
            line-height: 1.6;
            position: relative;
            min-height: 100vh;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            max-width: 800px;
            margin: 0 auto;
            height: 100vh;
            background: linear-gradient(to bottom, #1a1a2e, #16213e);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.7);
            position: relative;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(90deg, #2d0b5f, #4a1b8c);
            padding: 15px 20px;
            text-align: center;
            border-bottom: 2px solid #8a2be2;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }
        
        .game-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e6d4ff;
            text-shadow: 0 0 10px #9d4edd;
        }
        
        .status-bar {
            display: flex;
            gap: 15px;
        }
        
        .status-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.9rem;
            border: 1px solid #5a2d9c;
        }
        
        .content-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%231a1a2e"/><path d="M0 50L50 0L100 50L50 100Z" fill="%23221b3a" opacity="0.3"/></svg>');
            position: relative;
        }
        
        .message {
            background: rgba(30, 20, 60, 0.8);
            border-radius: 15px;
            padding: 15px;
            border-left: 5px solid #8a2be2;
            animation: fadeIn 0.5s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .system-message {
            border-left-color: #ff4757;
            background: rgba(60, 10, 30, 0.8);
        }
        
        .player-message {
            border-left-color: #2ed573;
            background: rgba(20, 60, 40, 0.8);
            margin-left: 20px;
        }
        
        .message-sender {
            font-weight: bold;
            margin-bottom: 8px;
            color: #9d88ff;
            font-size: 0.9rem;
        }
        
        .system-message .message-sender {
            color: #ff6b81;
        }
        
        .player-message .message-sender {
            color: #2ed573;
        }
        
        .message-content {
            font-size: 1rem;
            line-height: 1.5;
        }
        
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 10px 0;
        }
        
        .option-btn {
            background: linear-gradient(90deg, #3c1e6e, #5a2d9c);
            border: none;
            border-radius: 10px;
            padding: 15px;
            color: #f0f0f0;
            font-size: 1rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .option-btn:hover {
            background: linear-gradient(90deg, #4a2a7e, #6a3dac);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        
        .option-btn:active {
            transform: translateY(1px);
        }
        
        .option-btn.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .footer {
            background: rgba(20, 15, 40, 0.9);
            padding: 15px 20px;
            border-top: 2px solid #4a1b8c;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .icon-btn {
            background: rgba(80, 50, 140, 0.7);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .icon-btn:hover {
            background: rgba(100, 70, 160, 0.9);
            transform: scale(1.1);
        }
        
        .inventory-btn {
            position: relative;
        }
        
        .inventory-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            width: 90%;
            max-width: 600px;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.5);
            border: 2px solid #8a2be2;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #4a1b8c;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: #e6d4ff;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: #ff6b81;
            font-size: 1.8rem;
            cursor: pointer;
            line-height: 1;
        }
        
        .attribute-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .attribute-item {
            background: rgba(40, 30, 70, 0.7);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .attribute-name {
            font-weight: bold;
        }
        
        .attribute-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .attr-btn {
            background: #5a2d9c;
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }
        
        .attr-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .attribute-value {
            min-width: 30px;
            text-align: center;
            font-weight: bold;
            color: #9d88ff;
        }
        
        .status-display {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .status-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-label {
            min-width: 100px;
            font-weight: bold;
        }
        
        .status-bar-container {
            flex: 1;
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .status-bar-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .blackfill { background: linear-gradient(90deg, #2d0b5f, #8a2be2); }
        .lovefill { background: linear-gradient(90deg, #5f0b2d, #ff2b8a); }
        .ragefill { background: linear-gradient(90deg, #5f2d0b, #ff8a2b); }
        
        .status-value {
            min-width: 40px;
            text-align: right;
            font-weight: bold;
        }
        
        .shop-item {
            background: rgba(40, 30, 70, 0.7);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .shop-item-info {
            flex: 1;
        }
        
        .shop-item-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: #e6d4ff;
        }
        
        .shop-item-desc {
            font-size: 0.9rem;
            color: #b8b8d0;
        }
        
        .shop-item-price {
            font-weight: bold;
            color: #ffd700;
            margin-left: 15px;
        }
        
        .buy-btn {
            background: linear-gradient(90deg, #2d5f0b, #4a8c1b);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 15px;
        }
        
        .buy-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }
        
        .world-info {
            background: rgba(30, 20, 60, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #5a2d9c;
        }
        
        .world-title {
            font-size: 1.8rem;
            color: #9d88ff;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .world-desc {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .world-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .stat-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0f0f1a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .loading-text {
            font-size: 1.5rem;
            margin-top: 20px;
            color: #9d88ff;
            animation: pulse 1.5s infinite;
        }
        
        .progress-bar {
            width: 80%;
            max-width: 300px;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-top: 20px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #5a2d9c, #8a2be2);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .character-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid #8a2be2;
            object-fit: cover;
            margin-right: 15px;
        }
        
        .character-info {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .character-details {
            flex: 1;
        }
        
        .character-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #e6d4ff;
        }
        
        .character-desc {
            font-size: 0.9rem;
            color: #b8b8d0;
            margin-top: 5px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        @media (max-width: 600px) {
            .header {
                padding: 10px 15px;
            }
            
            .game-title {
                font-size: 1.2rem;
            }
            
            .content-area {
                padding: 15px;
            }
            
            .message {
                padding: 12px;
            }
            
            .option-btn {
                padding: 12px;
                font-size: 0.95rem;
            }
            
            .attribute-grid {
                grid-template-columns: 1fr;
            }
            
            .world-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container" id="gameContainer">
        <!-- æ¸¸æˆåŠ è½½ç•Œé¢ -->
        <div class="loading" id="loadingScreen">
            <div style="font-size: 2.5rem; color: #8a2be2;">â™¡</div>
            <div class="loading-text">ç—…å¨‡ç”·ä¸»è§£æ•‘ç³»ç»Ÿå¯åŠ¨ä¸­...</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
        
        <!-- æ¸¸æˆä¸»ç•Œé¢ -->
        <div class="header">
            <div class="game-title">ç—…å¨‡ç”·ä¸»è§£æ•‘ç³»ç»Ÿ</div>
            <div class="status-bar">
                <div class="status-item">ä¸–ç•Œ: <span id="currentWorld">0</span></div>
                <div class="status-item">é‡‘å¸: <span id="goldAmount">100</span></div>
                <div class="status-item">ç»éªŒ: <span id="expAmount">0</span></div>
            </div>
        </div>
        
        <div class="content-area" id="contentArea">
            <!-- æ¶ˆæ¯å’Œé€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
        </div>
        
        <div class="footer">
            <div class="action-buttons">
                <button class="icon-btn" id="inventoryBtn">ğŸ’<span class="inventory-count" id="inventoryCount">0</span></button>
                <button class="icon-btn" id="profileBtn">ğŸ‘¤</button>
                <button class="icon-btn" id="shopBtn">ğŸ›’</button>
                <button class="icon-btn" id="menuBtn">âš™ï¸</button>
            </div>
            <div style="color: #b8b8d0; font-size: 0.9rem;">
                å®¿ä¸»: <span style="color: #2ed573;">æ³—å¦</span>
            </div>
        </div>
    </div>
    
    <!-- å±æ€§åˆ†é…æ¨¡æ€æ¡† -->
    <div class="modal" id="attributeModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">å±æ€§ç‚¹åˆ†é…</div>
                <button class="close-modal" id="closeAttributeModal">Ã—</button>
            </div>
            <div class="message system-message">
                <div class="message-sender">ç³»ç»Ÿ</div>
                <div class="message-content">
                    å®¿ä¸»æ‚¨å¥½ï¼æ‚¨æœ‰ <span id="availablePoints">200</span> ç‚¹å±æ€§ç‚¹å¯ä»¥åˆ†é…ã€‚è¯·åˆç†åˆ†é…å±æ€§ç‚¹ï¼Œå®ƒä»¬å°†å½±å“æ‚¨åœ¨ä»»åŠ¡ä¸–ç•Œä¸­çš„è¡¨ç°ã€‚
                </div>
            </div>
            <div class="attribute-grid" id="attributeGrid">
                <!-- å±æ€§é¡¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="option-btn" id="confirmAttributes" style="width: 200px; margin: 0 auto;">ç¡®è®¤åˆ†é…</button>
            </div>
        </div>
    </div>
    
    <!-- çŠ¶æ€æŸ¥çœ‹æ¨¡æ€æ¡† -->
    <div class="modal" id="statusModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="statusTitle">çŠ¶æ€æŸ¥çœ‹</div>
                <button class="close-modal" id="closeStatusModal">Ã—</button>
            </div>
            <div class="status-display" id="statusDisplay">
                <!-- çŠ¶æ€ä¿¡æ¯å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
    </div>
    
    <!-- å•†åº—æ¨¡æ€æ¡† -->
    <div class="modal" id="shopModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ç³»ç»Ÿå•†åº—</div>
                <button class="close-modal" id="closeShopModal">Ã—</button>
            </div>
            <div class="message system-message">
                <div class="message-sender">ç³»ç»Ÿ</div>
                <div class="message-content">
                    æ¬¢è¿æ¥åˆ°ç³»ç»Ÿå•†åº—ï¼æ‚¨å¯ä»¥ä½¿ç”¨é‡‘å¸è´­ä¹°é“å…·ï¼Œè¿™äº›é“å…·å¯ä»¥åœ¨ä»»åŠ¡ä¸–ç•Œä¸­ä¸ºæ‚¨æä¾›å¸®åŠ©ã€‚
                </div>
            </div>
            <div id="shopItems">
                <!-- å•†å“é¡¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
    </div>
    
    <!-- èƒŒåŒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="inventoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">èƒŒåŒ…</div>
                <button class="close-modal" id="closeInventoryModal">Ã—</button>
            </div>
            <div id="inventoryItems">
                <!-- èƒŒåŒ…ç‰©å“å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
    </div>
    
    <!-- èœå•æ¨¡æ€æ¡† -->
    <div class="modal" id="menuModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">æ¸¸æˆèœå•</div>
                <button class="close-modal" id="closeMenuModal">Ã—</button>
            </div>
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <button class="option-btn" id="saveGameBtn">ä¿å­˜æ¸¸æˆ</button>
                <button class="option-btn" id="loadGameBtn">è¯»å–æ¸¸æˆ</button>
                <button class="option-btn" id="restartGameBtn">é‡æ–°å¼€å§‹</button>
                <button class="option-btn" id="helpBtn">æ¸¸æˆå¸®åŠ©</button>
                <button class="option-btn" id="aboutBtn">å…³äºæ¸¸æˆ</button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€ç®¡ç†
        const gameState = {
            currentWorld: 0,
            currentScene: 0,
            gold: 100,
            exp: 0,
            attributes: {
                æ™ºæ…§: 50,
                ç¾è²Œ: 50,
                æ­¦åŠ›: 50,
                é­…åŠ›: 50,
                ä½“è´¨: 50
            },
            attributePoints: 200,
            inventory: [],
            usedItems: [],
            purchasedItems: [],
            completedWorlds: [],
            currentWorldData: null,
            playerName: "æ³—å¦",
            systemName: "ç—…å¨‡ç”·ä¸»è§£æ•‘ç³»ç»Ÿ",
            gameStarted: false,
            // å½“å‰ä¸–ç•ŒçŠ¶æ€
            worldState: {
                blackValue: 0,
                loveValue: 0,
                rageValue: 0,
                storyProgress: 0
            },
            // å·²è§¦å‘çš„å‰§æƒ…èŠ‚ç‚¹IDï¼Œç”¨äºé˜²é‡å¤
            triggeredScenes: new Set()
        };

        // ä¸–ç•Œæ•°æ®
        const worlds = [
            {
                id: 1,
                title: "ä¸–ç•Œä¸€ï¼šæ ¡å›­ç—…å¨‡å­¦ç¥",
                background: "è¿™æ˜¯ä¸€ä¸ªç°ä»£æ ¡å›­ä¸–ç•Œã€‚ç”·ä¸»æ±Ÿè¾°æ˜¯å­¦æ ¡çš„å¤©æ‰å­¦ç¥ï¼Œé•¿ç›¸ä¿Šç¾ï¼Œå®¶ä¸–æ˜¾èµ«ï¼Œä½†æ€§æ ¼å­¤åƒ»ï¼Œæœ‰ä¸¥é‡çš„åæ‰§å‹äººæ ¼éšœç¢ã€‚å‰ä¸–ä»–çˆ±ä¸Šäº†åŒç­å¥³ç”Ÿæ—å©‰å„¿ï¼Œä½†æ—å©‰å„¿æ— æ³•æ¥å—ä»–è¿‡åº¦çš„å æœ‰æ¬²å’Œæ§åˆ¶æ¬²ï¼Œæœ€ç»ˆè”åˆåŒå­¦å­¤ç«‹ä»–ï¼Œå¯¼è‡´ä»–å½»åº•é»‘åŒ–ï¼Œæœ€ç»ˆé€ æˆæ— æ³•æŒ½å›çš„æ‚²å‰§ã€‚",
                hostIdentity: "ä½ æ˜¯è½¬å­¦åˆ°è¿™æ‰€é«˜ä¸­çš„æ–°ç”Ÿæ³—å¦ï¼Œä¸€ä¸ªå¤–è¡¨æ™®é€šä½†æ€§æ ¼æ¸©æŸ”åšéŸ§çš„å¥³å­©ã€‚ä½ çš„åº§ä½è¢«å®‰æ’åœ¨æ±Ÿè¾°æ—è¾¹ï¼Œè¿™æ˜¯ä½ æ¥è§¦ä»–çš„æœºä¼šã€‚",
                maleLead: {
                    name: "æ±Ÿè¾°",
                    age: 18,
                    identity: "å­¦æ ¡å¤©æ‰å­¦ç¥ï¼Œæ±Ÿæ°é›†å›¢ç»§æ‰¿äºº",
                    personality: "è¡¨é¢å†·æ¼ ç–ç¦»ï¼Œå†…å¿ƒæåº¦ç¼ºä¹å®‰å…¨æ„Ÿï¼Œæœ‰å¼ºçƒˆçš„å æœ‰æ¬²å’Œæ§åˆ¶æ¬²ã€‚æ™ºå•†æé«˜ï¼Œè§‚å¯ŸåŠ›æ•é”ï¼Œå¯¹åœ¨æ„çš„äººä¼šå±•ç°å‡ºæç«¯çš„ä¿æŠ¤æ¬²ã€‚",
                    initialValues: {
                        black: 65,
                        love: 0,
                        rage: 40,
                        possession: 85
                    }
                },
                scenes: [
                    // åœºæ™¯1-5
                    {
                        id: "scene1",
                        type: "system",
                        content: "æ¬¢è¿æ¥åˆ°æ ¡å›­ç—…å¨‡å­¦ç¥ä¸–ç•Œï¼ä¼ é€å®Œæˆï¼Œæ—¶é—´ç‚¹ï¼šæ–°å­¦æœŸå¼€å§‹çš„ç¬¬ä¸€å¤©ã€‚ä½ å·²æˆåŠŸè½¬å­¦åˆ°åœ£æ¨±é«˜ä¸­ï¼Œè¢«åˆ†é…åˆ°é«˜äºŒï¼ˆ3ï¼‰ç­ã€‚ç­ä¸»ä»»å°†ä½ å¸¦è¿›æ•™å®¤ï¼Œå‘å…¨ç­åŒå­¦ä»‹ç»ä½ çš„åˆ°æ¥ã€‚",
                        options: [
                            { text: "ç¤¼è²Œåœ°å‘å…¨ç­åŒå­¦é èº¬é—®å¥½", next: "scene2", effects: { charm: 5 } },
                            { text: "ç®€å•åœ°è‡ªæˆ‘ä»‹ç»ï¼Œç„¶åçœ‹å‘è‡ªå·±çš„åº§ä½", next: "scene2", effects: { wisdom: 5 } },
                            { text: "è…¼è…†åœ°å¾®ç¬‘ï¼Œå°å£°è¯´è¯·å¤§å®¶å¤šå¤šå…³ç…§", next: "scene2", effects: { charm: 3, wisdom: 2 } }
                        ]
                    },
                    {
                        id: "scene2",
                        type: "system",
                        content: "ç­ä¸»ä»»æŒ‡ç€æ•™å®¤åæ’é çª—çš„ä½ç½®è¯´ï¼šâ€œæ³—å¦åŒå­¦ï¼Œä½ çš„åº§ä½åœ¨æ±Ÿè¾°åŒå­¦æ—è¾¹ã€‚æ±Ÿè¾°åŒå­¦æˆç»©ä¼˜å¼‚ï¼Œä½ æœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥å‘ä»–è¯·æ•™ã€‚â€ä½ é¡ºç€è€å¸ˆæŒ‡çš„æ–¹å‘çœ‹å»ï¼Œä¸€ä¸ªç©¿ç€æ•´æ´æ ¡æœçš„ç”·ç”Ÿæ­£æœ›ç€çª—å¤–ï¼Œä¾§è„¸çº¿æ¡å®Œç¾ï¼Œä½†å‘¨èº«æ•£å‘ç€ç”Ÿäººå‹¿è¿‘çš„æ°”åœºã€‚",
                        options: [
                            { text: "èµ°å‘åº§ä½ï¼Œè½»å£°å‘æ±Ÿè¾°æ‰“æ‹›å‘¼", next: "scene3", effects: { charm: 5 } },
                            { text: "å®‰é™åœ°èµ°åˆ°åº§ä½åä¸‹ï¼Œä¸æ‰“æ‰°ä»–", next: "scene3", effects: { wisdom: 5 } },
                            { text: "å¯¹è€å¸ˆç‚¹å¤´ï¼Œç„¶åèµ°å‘åº§ä½ï¼Œé€”ä¸­è§‚å¯Ÿæ•™å®¤ç¯å¢ƒ", next: "scene3", effects: { wisdom: 3, charm: 2 } }
                        ]
                    },
                    {
                        id: "scene3",
                        type: "system",
                        content: "ä½ èµ°åˆ°åº§ä½åä¸‹ï¼Œæ±Ÿè¾°ä¼¼ä¹å®Œå…¨æ²¡æœ‰æ³¨æ„åˆ°ä½ çš„åˆ°æ¥ï¼Œä¾æ—§æœ›ç€çª—å¤–ã€‚ä½ æ³¨æ„åˆ°ä»–çš„æ¡Œé¢ä¸Šå¼‚å¸¸æ•´æ´ï¼Œåªæœ‰ä¸€æ”¯ç¬”å’Œä¸€æœ¬ç¿»å¼€çš„ç«èµ›é¢˜é›†ï¼Œä¹¦é¡µä¸Šå¯†å¯†éº»éº»å†™æ»¡äº†å¤æ‚çš„å…¬å¼ã€‚ä»–çš„æ‰‹æŒ‡ä¿®é•¿ï¼Œæ­£æ— æ„è¯†åœ°è½¬åŠ¨ç€é‚£æ”¯ç¬”ã€‚",
                        options: [
                            { text: "ä¸»åŠ¨æ‰“ç ´æ²‰é»˜ï¼Œä»‹ç»è‡ªå·±", next: "scene4", effects: { charm: 8, black: -2 } },
                            { text: "å…ˆæ•´ç†è‡ªå·±çš„ç‰©å“ï¼Œç­‰å¾…åˆé€‚çš„æ—¶æœº", next: "scene4", effects: { wisdom: 8 } },
                            { text: "è§‚å¯Ÿä»–æ­£åœ¨åšçš„é¢˜ç›®ï¼Œå¯»æ‰¾å…±åŒè¯é¢˜", next: "scene4", effects: { wisdom: 10, black: -1 } }
                        ]
                    },
                    {
                        id: "scene4",
                        type: "system",
                        content: "ç¬¬ä¸€èŠ‚è¯¾æ˜¯æ•°å­¦è¯¾ï¼Œè€å¸ˆè®²è§£çš„å†…å®¹å¯¹ä½ æ¥è¯´æœ‰äº›éš¾åº¦ã€‚ä½ æ³¨æ„åˆ°æ±Ÿè¾°è™½ç„¶çœ‹ç€çª—å¤–ï¼Œä½†è€å¸ˆæé—®æ—¶ä»–æ€»èƒ½å‡†ç¡®å›ç­”ã€‚ä½ çš„ç¬”ä¸å°å¿ƒæ»šè½åˆ°ä»–çš„è„šè¾¹ï¼Œä»–ä½å¤´çœ‹äº†ä¸€çœ¼ï¼Œå´æ²¡æœ‰å¸®å¿™æ¡èµ·çš„æ„æ€ã€‚",
                        options: [
                            { text: "è‡ªå·±å¼¯è…°æ¡èµ·ç¬”ï¼Œè½»å£°è¯´â€œä¸å¥½æ„æ€â€", next: "scene5", effects: { charm: 5, wisdom: 3 } },
                            { text: "ç­‰å¾…ä»–å¸®å¿™æ¡èµ·ï¼Œè¶æœºå¼€å¯å¯¹è¯", next: "scene5", effects: { charm: 8 } },
                            { text: "ç”¨å¦ä¸€æ”¯ç¬”ï¼Œä¸‹è¯¾åå†æ¡", next: "scene5", effects: { wisdom: 7 } }
                        ]
                    },
                    {
                        id: "scene5",
                        type: "system",
                        content: "ä¸‹è¯¾é“ƒå£°å“èµ·ï¼Œæ±Ÿè¾°ç«‹åˆ»èµ·èº«ç¦»å¼€æ•™å®¤ã€‚ä½ çœ‹ç€ä»–ç¦»å»çš„èƒŒå½±ï¼Œæ³¨æ„åˆ°ä»–èµ°è·¯æ—¶å¾®å¾®ä½ç€å¤´ï¼Œä¼¼ä¹åˆ»æ„é¿å¼€ä¸ä»»ä½•äººçš„æ¥è§¦ã€‚ä½ çš„å‰æ¡Œå¥³ç”Ÿè½¬è¿‡å¤´æ¥ï¼Œå°å£°æé†’ä½ ï¼šâ€œä»–æ˜¯æ±Ÿè¾°ï¼Œå­¦æ ¡æœ‰åçš„å†°å±±å­¦ç¥ï¼Œå¾ˆå°‘å’Œäººè¯´è¯ï¼Œä½ æœ€å¥½ä¸è¦æ‹›æƒ¹ä»–ã€‚â€",
                        options: [
                            { text: "è¯¢é—®æ›´å¤šå…³äºæ±Ÿè¾°çš„ä¿¡æ¯", next: "scene6", effects: { wisdom: 8, black: 1 } },
                            { text: "ç¤¼è²Œåœ°æ„Ÿè°¢æé†’ï¼Œä½†è¡¨ç¤ºè‡ªå·±ä¼šåˆ¤æ–­", next: "scene6", effects: { charm: 6, wisdom: 4 } },
                            { text: "è½¬ç§»è¯é¢˜ï¼Œè¯¢é—®å­¦æ ¡å…¶ä»–æƒ…å†µ", next: "scene6", effects: { wisdom: 5, charm: 5 } }
                        ]
                    },
                    // åœºæ™¯6-10
                    {
                        id: "scene6",
                        type: "system",
                        content: "ä»åŒå­¦é‚£é‡Œä½ äº†è§£åˆ°ï¼Œæ±Ÿè¾°è™½ç„¶æˆç»©ä¼˜å¼‚ï¼Œä½†å‡ ä¹æ²¡æœ‰æœ‹å‹ã€‚æœ‰äººè¯´ä»–æ€§æ ¼å¤æ€ªï¼Œæœ‰äººè¯´ä»–å®¶ä¸–å¤ªå¥½çœ‹ä¸èµ·æ™®é€šäººã€‚åˆä¼‘æ—¶é—´ï¼Œä½ å‘ç°æ±Ÿè¾°ç‹¬è‡ªä¸€äººåœ¨å¤©å°åƒåˆé¥­ï¼ŒèƒŒå½±æ˜¾å¾—æ ¼å¤–å­¤ç‹¬ã€‚",
                        options: [
                            { text: "å¸¦ç€è‡ªå·±çš„åˆé¤å»å¤©å°ï¼Œå°è¯•å’Œä»–ä¸€èµ·åƒé¥­", next: "scene7", effects: { charm: 10, black: -3, rage: 2 } },
                            { text: "åœ¨è¿œå¤„è§‚å¯Ÿä»–ï¼Œäº†è§£ä»–çš„ä¹ æƒ¯", next: "scene7", effects: { wisdom: 10, black: -1 } },
                            { text: "å…ˆå®Œæˆè‡ªå·±çš„äº‹æƒ…ï¼Œç¨åå†æ‰¾æœºä¼šæ¥è§¦", next: "scene7", effects: { wisdom: 7, charm: 3 } }
                        ]
                    },
                    {
                        id: "scene7",
                        type: "system",
                        content: "å‡ å¤©åçš„æ•°å­¦æµ‹éªŒï¼Œä½ å› ä¸ºè½¬å­¦è¿›åº¦ä¸åŒï¼Œæœ‰å‡ é“é¢˜å®Œå…¨ä¸ä¼šã€‚ä½ æ³¨æ„åˆ°æ±Ÿè¾°å·²ç»åšå®Œè¯•å·ï¼Œæ­£åœ¨æ£€æŸ¥ã€‚ä»–å¯Ÿè§‰åˆ°ä½ çš„è§†çº¿ï¼Œè½¬å¤´çœ‹äº†ä½ ä¸€çœ¼ï¼Œçœ¼ç¥å†·æ·¡ã€‚",
                        options: [
                            { text: "ç”¨æ±‚åŠ©çš„çœ¼ç¥çœ‹ç€ä»–ï¼Œå¸Œæœ›å¾—åˆ°æç¤º", next: "scene8", effects: { charm: 8, black: 1 } },
                            { text: "æ”¶å›è§†çº¿ï¼Œå°½åŠ›å®Œæˆè‡ªå·±èƒ½åšçš„éƒ¨åˆ†", next: "scene8", effects: { wisdom: 8, charm: 2 } },
                            { text: "åœ¨è‰ç¨¿çº¸ä¸Šå†™ä¸‹é—®é¢˜ï¼Œæ‚„æ‚„æ¨ç»™ä»–çœ‹", next: "scene8", effects: { wisdom: 10, black: -2, rage: 3 } }
                        ]
                    },
                    {
                        id: "scene8",
                        type: "system",
                        content: "æµ‹éªŒç»“æŸåï¼Œæ±Ÿè¾°ç¬¬ä¸€ä¸ªäº¤å·ç¦»å¼€ã€‚ä½ äº¤å·æ—¶ï¼Œè€å¸ˆå«ä½ä½ ï¼Œå§”å©‰åœ°æé†’ä½ æˆç»©ä¸å¤ªç†æƒ³ã€‚æ”¾å­¦åï¼Œä½ å‘ç°æ±Ÿè¾°æ­£åœ¨å›¾ä¹¦é¦†è§’è½çœ‹ä¹¦ï¼Œå‘¨å›´æ²¡æœ‰å…¶ä»–äººã€‚",
                        options: [
                            { text: "æ‹¿ç€è¯•å·å‘ä»–è¯·æ•™é”™é¢˜", next: "scene9", effects: { wisdom: 10, charm: 5, black: -2 } },
                            { text: "ååœ¨ä¸è¿œå¤„å­¦ä¹ ï¼Œå¶å°”å‘ä»–æŠ•å»ç›®å…‰", next: "scene9", effects: { wisdom: 8, charm: 3 } },
                            { text: "å…ˆè§£å†³è‡ªå·±çš„é—®é¢˜ï¼Œæ”¹å¤©å†æ‰¾ä»–", next: "scene9", effects: { wisdom: 7 } }
                        ]
                    },
                    {
                        id: "scene9",
                        type: "system",
                        content: "ä½ é¼“èµ·å‹‡æ°”èµ°å‘æ±Ÿè¾°ï¼Œä»–æŠ¬èµ·å¤´ï¼Œçœ¼ç¥å†·æ¼ åœ°çœ‹ç€ä½ ã€‚ä½ è¯´æ˜æ¥æ„åï¼Œä»–æ²‰é»˜äº†å‡ ç§’ï¼Œç„¶åæŒ‡äº†æŒ‡å¯¹é¢çš„åº§ä½ã€‚ä½ åä¸‹åï¼Œä»–ç®€æ´åœ°è®²è§£äº†ç¬¬ä¸€é“é”™é¢˜ï¼Œæ€è·¯æ¸…æ™°ä½†è¯­æ°”å†·æ·¡ã€‚",
                        options: [
                            { text: "è®¤çœŸå¬è®²ï¼Œé€‚æ—¶æå‡ºé—®é¢˜", next: "scene10", effects: { wisdom: 12, love: 5, black: -3 } },
                            { text: "è®°å½•ä¸‹ä»–çš„è§£é¢˜æ­¥éª¤ï¼Œè¡¨ç¤ºæ„Ÿè°¢", next: "scene10", effects: { wisdom: 10, charm: 5, black: -2 } },
                            { text: "ç§°èµä»–çš„è§£é¢˜èƒ½åŠ›ï¼Œè¡¨è¾¾æ•¬ä½©", next: "scene10", effects: { charm: 10, wisdom: 5, black: -1 } }
                        ]
                    },
                    {
                        id: "scene10",
                        type: "system",
                        content: "æ±Ÿè¾°è®²å®Œå‡ é“é¢˜åï¼Œçœ‹äº†çœ¼æ—¶é—´ï¼Œå¼€å§‹æ”¶æ‹¾ä¹¦æœ¬ã€‚ä½ æ³¨æ„åˆ°ä»–çš„æ‰‹æŒ‡åœ¨è§¦ç¢°åˆ°ä¹¦é¡µæ—¶å¾®å¾®é¢¤æŠ–ï¼Œä¼¼ä¹æœ‰äº›ä¸è€çƒ¦ã€‚å°±åœ¨ä½ å‡†å¤‡é“è°¢æ—¶ï¼Œä»–çš„æ‰‹æœºå“äº†ï¼Œä»–çœ‹åˆ°æ¥ç”µæ˜¾ç¤ºåè„¸è‰²æ˜æ˜¾é˜´æ²‰ä¸‹æ¥ã€‚",
                        options: [
                            { text: "ç¤¼è²Œåœ°ç­‰å¾…ä»–æ¥ç”µè¯", next: "scene11", effects: { wisdom: 8, charm: 3 } },
                            { text: "è½»å£°è¯´â€œä½ å…ˆå¿™â€ï¼Œç„¶åç¨å¾®é€€å¼€", next: "scene11", effects: { charm: 8, wisdom: 5 } },
                            { text: "æ³¨æ„åˆ°ä»–çš„è¡¨æƒ…å˜åŒ–ï¼Œéœ²å‡ºå…³å¿ƒçš„ç¥è‰²", next: "scene11", effects: { charm: 10, wisdom: 3, love: 3, rage: 2 } }
                        ]
                    }
                    // æ›´å¤šåœºæ™¯å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ 
                ]
            }
            // æ›´å¤šä¸–ç•Œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ 
        ];

        // å•†åº—ç‰©å“
        const shopItems = [
            {
                id: "item1",
                name: "å¿ƒçµæ„Ÿåº”ç¬¦",
                description: "ä½¿ç”¨åå¯çŸ­æš‚æ„Ÿåº”ç›®æ ‡å½“å‰æƒ…ç»ªçŠ¶æ€ï¼ŒæŒç»­30åˆ†é’Ÿ",
                price: 50,
                effect: "å¯æŸ¥çœ‹ç”·ä¸»å½“å‰å‡†ç¡®çš„æƒ…ç»ªå€¼"
            },
            {
                id: "item2",
                name: "æ¸©æŸ”å…‰ç¯",
                description: "ä½¿ç”¨åè‡ªèº«é­…åŠ›å€¼ä¸´æ—¶æå‡20ç‚¹ï¼ŒæŒç»­1å°æ—¶",
                price: 80,
                effect: "é­…åŠ›+20ä¸´æ—¶"
            },
            {
                id: "item3",
                name: "é•‡é™å‰‚",
                description: "å¯é™ä½ç›®æ ‡ç‹‚èºå€¼10-20ç‚¹",
                price: 120,
                effect: "ç‹‚èºå€¼é™ä½"
            },
            {
                id: "item4",
                name: "è®°å¿†ç¢ç‰‡",
                description: "å¯çª¥æ¢ç›®æ ‡ä¸€æ®µä¸é‡è¦çš„è®°å¿†ç‰‡æ®µ",
                price: 150,
                effect: "äº†è§£ç”·ä¸»è¿‡å»"
            },
            {
                id: "item5",
                name: "å®‰å…¨è­¦æŠ¥",
                description: "å½“é»‘åŒ–å€¼è¶…è¿‡80æ—¶è‡ªåŠ¨å‘å‡ºè­¦å‘Š",
                price: 200,
                effect: "é»‘åŒ–å€¼é¢„è­¦"
            }
        ];

        // DOMå…ƒç´ 
        const loadingScreen = document.getElementById('loadingScreen');
        const progressFill = document.getElementById('progressFill');
        const contentArea = document.getElementById('contentArea');
        const attributeModal = document.getElementById('attributeModal');
        const statusModal = document.getElementById('statusModal');
        const shopModal = document.getElementById('shopModal');
        const inventoryModal = document.getElementById('inventoryModal');
        const menuModal = document.getElementById('menuModal');
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            simulateLoading(() => {
                startGame();
            });
        }
        
        // æ¨¡æ‹ŸåŠ è½½è¿‡ç¨‹
        function simulateLoading(callback) {
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15 + 5;
                if (progress > 100) {
                    progress = 100;
                    clearInterval(interval);
                    progressFill.style.width = '100%';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        callback();
                    }, 500);
                } else {
                    progressFill.style.width = progress + '%';
                }
            }, 150);
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (!gameState.gameStarted) {
                addMessage(gameState.systemName, "å®ï¼ç—…å¨‡ç”·ä¸»è§£æ•‘ç³»ç»Ÿå·²æ¿€æ´»ï¼æˆ‘æ˜¯æ‚¨çš„ä¸“å±ç³»ç»Ÿï¼Œå°†ååŠ©æ‚¨ç©¿è¶Šå„ä¸ªä¸–ç•Œï¼Œè§£æ•‘é‚£äº›è¢«åŸä¸–ç•Œå«Œå¼ƒæŠ›å¼ƒçš„ç—…å¨‡ç”·ä¸»ã€‚æ¯ä¸ªä¸–ç•Œï¼Œæ‚¨éƒ½å°†ä»¥'æ³—å¦'çš„èº«ä»½å‡ºç°ï¼Œé€šè¿‡åšå®šçš„é€‰æ‹©å’Œç†è§£ï¼Œé™ä½ç”·ä¸»çš„é»‘åŒ–å€¼ï¼Œå¸®åŠ©ä»–ä»¬èµ°å‘æ­£å¸¸çš„ç”Ÿæ´»ã€‚æ‚¨æ„¿æ„ç»‘å®šç³»ç»Ÿï¼Œå¼€å§‹è¿™æ®µæ—…ç¨‹å—ï¼Ÿ");
                addOptions([
                    { text: "æˆ‘æ„¿æ„ç»‘å®šç³»ç»Ÿ", action: () => confirmBinding() },
                    { text: "æˆ‘éœ€è¦æ›´å¤šä¿¡æ¯", action: () => askForMoreInfo() },
                    { text: "è¿™å¬èµ·æ¥æœ‰ç‚¹å±é™©...", action: () => expressConcern() }
                ]);
                gameState.gameStarted = true;
            }
        }
        
        // ç¡®è®¤ç»‘å®š
        function confirmBinding() {
            addMessage(gameState.playerName, "æˆ‘æ„¿æ„ç»‘å®šç³»ç»Ÿï¼Œå¼€å§‹ä»»åŠ¡ï¼");
            setTimeout(() => {
                addMessage(gameState.systemName, "ç»‘å®šæˆåŠŸï¼å®¿ä¸»æ³—å¦ï¼Œæ¬¢è¿åŠ å…¥ç—…å¨‡ç”·ä¸»è§£æ•‘ç³»ç»Ÿã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä¸ºæ‚¨ä»‹ç»ç³»ç»Ÿè§„åˆ™ï¼š\n\n1. æ‚¨å°†è·å¾—200åˆå§‹å±æ€§ç‚¹ï¼Œå¯ä»¥åˆ†é…åˆ°æ™ºæ…§ã€ç¾è²Œã€æ­¦åŠ›ã€é­…åŠ›ã€ä½“è´¨äº”ä¸ªå±æ€§ä¸Šã€‚\n2. æ¯ä¸ªä¸–ç•Œç»“æŸåï¼Œæ ¹æ®æ‚¨çš„è¡¨ç°ä¼šè·å¾—ç»éªŒå€¼å’Œå¯åˆ†é…å±æ€§ç‚¹ã€‚\n3. æ‚¨æœ‰100åˆå§‹é‡‘å¸ï¼Œå¯ä»¥åœ¨ç³»ç»Ÿå•†åº—è´­ä¹°é“å…·ï¼Œç”¨äºè¾…åŠ©ä»»åŠ¡ã€‚\n4. ä»»åŠ¡å…³é”®èŠ‚ç‚¹ï¼Œæˆ‘ä¼šæä¾›å¤šä¸ªé€‰æ‹©ï¼Œæ‚¨çš„é€‰æ‹©å°†å½±å“å‰§æƒ…å‘å±•å’Œç”·ä¸»çŠ¶æ€ã€‚\n5. ç”·ä¸»çš„é»‘åŒ–å€¼ã€ç‹‚èºå€¼ã€çˆ±æ„å€¼ç­‰çŠ¶æ€å¯ä»¥éšæ—¶æŸ¥çœ‹ã€‚\n6. åªæœ‰é»‘åŒ–å€¼æ¸…é›¶ï¼Œæ‰ç®—ä»»åŠ¡æˆåŠŸã€‚\n\nç°åœ¨ï¼Œè¯·åˆ†é…æ‚¨çš„åˆå§‹å±æ€§ç‚¹ã€‚");
                showAttributeModal();
            }, 1000);
        }
        
        // è¯¢é—®æ›´å¤šä¿¡æ¯
        function askForMoreInfo() {
            addMessage(gameState.playerName, "æˆ‘éœ€è¦æ›´å¤šå…³äºç³»ç»Ÿçš„ä¿¡æ¯ã€‚");
            setTimeout(() => {
                addMessage(gameState.systemName, "ç—…å¨‡ç”·ä¸»è§£æ•‘ç³»ç»Ÿæ˜¯ä¸€ä¸ªè·¨ç»´åº¦æ•‘æ´é¡¹ç›®ã€‚æ¯ä¸ªä¸–ç•Œçš„ç”·ä¸»éƒ½å› ä¸ºåæ‰§å‹äººæ ¼éšœç¢ï¼Œè¢«åŸä¸–ç•Œçš„äººæ’æ–¥ï¼Œæœ€ç»ˆèµ°å‘æ¯ç­ã€‚æ‚¨çš„ä»»åŠ¡æ˜¯ç©¿è¶Šåˆ°è¿™äº›ä¸–ç•Œï¼Œä»¥'æ³—å¦'çš„èº«ä»½å‡ºç°åœ¨ä»–ä»¬èº«è¾¹ï¼Œé€šè¿‡ç†è§£ã€æ¥çº³å’Œåšå®šçš„é€‰æ‹©ï¼Œå¸®åŠ©ä»–ä»¬é™ä½é»‘åŒ–å€¼ï¼Œé¿å…æ‚²å‰§å‘ç”Ÿã€‚\n\nè¯·æ³¨æ„ï¼šæ¯ä¸ªä¸–ç•Œçš„ç”·ä¸»éƒ½æ²¡æœ‰å‰ä¸–è®°å¿†ï¼Œæ‚¨çš„èº«ä»½æ˜¯åŸä¸–ç•Œè·¯äººç”²ã€‚ä»»åŠ¡è¿‡ç¨‹ä¸­ï¼Œç”·ä¸»ä¼šå¯¹æ‚¨ä¸€è§é’Ÿæƒ…ï¼Œå¹¶æ¿€å‘å‡ºæ‰€æœ‰é˜´æš—é¢ã€‚æœ‰ä¸€åŠæ¦‚ç‡ä¼šè§¦å‘'å°é»‘å±‹'æƒ…èŠ‚ï¼Œä½†æ‚¨éœ€è¦è¡¨è¾¾æ¥çº³ï¼Œå‘Šè¯‰ä»–'æ²¡å…³ç³»ï¼Œæˆ‘æ¥å—ä½ çš„ä¸€åˆ‡'ã€‚\n\nä»»åŠ¡æˆåŠŸçš„å…³é”®æ˜¯ï¼šè®©ç”·ä¸»æ„Ÿå—åˆ°æ— æ¡ä»¶çš„æ¥çº³ï¼ŒåŒæ—¶å¼•å¯¼ä»–é€æ¸æ§åˆ¶è‡ªå·±çš„é˜´æš—é¢ã€‚");
                addOptions([
                    { text: "æ˜ç™½äº†ï¼Œæˆ‘æ„¿æ„ç»‘å®šç³»ç»Ÿ", action: () => confirmBinding() },
                    { text: "æˆ‘è¿˜æœ‰é—®é¢˜...", action: () => askMoreQuestions() }
                ]);
            }, 1000);
        }
        
        // è¡¨è¾¾æ‹…å¿§
        function expressConcern() {
            addMessage(gameState.playerName, "è¿™å¬èµ·æ¥æœ‰ç‚¹å±é™©...ç—…å¨‡ç”·ä¸»ä¸æ˜¯ä¼šæœ‰æ§åˆ¶æ¬²å’Œå æœ‰æ¬²å—ï¼Ÿ");
            setTimeout(() => {
                addMessage(gameState.systemName, "æ‚¨çš„æ‹…å¿§æ˜¯åˆç†çš„ã€‚ç¡®å®ï¼Œç—…å¨‡ç”·ä¸»å…·æœ‰å¼ºçƒˆçš„æ§åˆ¶æ¬²å’Œå æœ‰æ¬²ï¼Œç”šè‡³å¯èƒ½æœ‰æš´åŠ›å€¾å‘ã€‚ä½†è¿™å°±æ˜¯ä»»åŠ¡çš„æ„ä¹‰â€”â€”é€šè¿‡æ‚¨çš„æ¥çº³å’Œå¼•å¯¼ï¼Œå¸®åŠ©ä»–ä»¬å­¦ä¼šä»¥å¥åº·çš„æ–¹å¼è¡¨è¾¾çˆ±ã€‚ç³»ç»Ÿä¼šæä¾›ä¿æŠ¤æœºåˆ¶ï¼Œå¹¶åœ¨å±é™©å€¼è¿‡é«˜æ—¶å‘å‡ºè­¦å‘Šã€‚è€Œä¸”ï¼Œæ‚¨åœ¨æ¯ä¸ªä¸–ç•Œè·å¾—çš„èƒ½åŠ›å’Œé“å…·ä¹Ÿä¼šå¸®åŠ©æ‚¨åº”å¯¹å„ç§æƒ…å†µã€‚\n\nè¯·è®°ä½ï¼Œæ‚¨çš„å®‰å…¨æ˜¯é¦–è¦çš„ã€‚å¦‚æœé»‘åŒ–å€¼è¶…è¿‡90ï¼Œç³»ç»Ÿä¼šå¯åŠ¨ç´§æ€¥è„±ç¦»ç¨‹åºã€‚");
                addOptions([
                    { text: "æˆ‘æ„¿æ„å°è¯•", action: () => confirmBinding() },
                    { text: "æˆ‘è¿˜æ˜¯æœ‰ç‚¹å®³æ€•", action: () => expressFear() }
                ]);
            }, 1000);
        }
        
        // è¯¢é—®æ›´å¤šé—®é¢˜
        function askMoreQuestions() {
            addMessage(gameState.playerName, "æ¯ä¸ªä¸–ç•Œéƒ½è¦å’Œç”·ä¸»ç›¸ä¼´ä¸€ç”Ÿå—ï¼Ÿå¯ä»¥ä¸­é€”ç¦»å¼€å—ï¼Ÿ");
            setTimeout(() => {
                addMessage(gameState.systemName, "ä»»åŠ¡è¦æ±‚æ˜¯ç›¸ä¼´ä¸€ç”Ÿï¼Œç›´åˆ°ç”·ä¸»è‡ªç„¶ç¦»ä¸–ã€‚è¿™æ˜¯å»ºç«‹æ·±åº¦ä¿¡ä»»çš„å¿…è¦è¿‡ç¨‹ã€‚ä¸­é€”è„±ç¦»ä¼šå¯¼è‡´ä»»åŠ¡å¤±è´¥ï¼Œç”·ä¸»é»‘åŒ–å€¼ä¼šåå¼¹åˆ°æ›´é«˜æ°´å¹³ã€‚ä½†å¦‚æœæ‚¨é‡åˆ°æ— æ³•æ‰¿å—çš„æƒ…å†µï¼Œç³»ç»Ÿå¯ä»¥å¯åŠ¨ç´§æ€¥è„±ç¦»ç¨‹åºï¼Œä½†è¿™ä¼šå½±å“æ‚¨çš„ä»»åŠ¡è¯„åˆ†ã€‚\n\næ¯ä¸ªä¸–ç•Œçš„æ—¶é—´æµé€Ÿä¸åŒï¼Œä¸»ä¸–ç•Œæ—¶é—´å‡ ä¹é™æ­¢ï¼Œæ‚¨ä¸ä¼šè¡°è€ã€‚å®Œæˆä»»åŠ¡åï¼Œæ‚¨ä¼šè¿”å›ç³»ç»Ÿç©ºé—´ï¼Œå‡†å¤‡è¿›å…¥ä¸‹ä¸€ä¸ªä¸–ç•Œã€‚");
                addOptions([
                    { text: "æˆ‘ç†è§£äº†ï¼Œç»‘å®šç³»ç»Ÿ", action: () => confirmBinding() },
                    { text: "è¿˜æœ‰é—®é¢˜...", action: () => askAboutRewards() }
                ]);
            }, 1000);
        }
        
        // è¯¢é—®å¥–åŠ±
        function askAboutRewards() {
            addMessage(gameState.playerName, "ä»»åŠ¡å®Œæˆåæœ‰ä»€ä¹ˆå¥–åŠ±ï¼Ÿ");
            setTimeout(() => {
                addMessage(gameState.systemName, "æ¯ä¸ªä¸–ç•Œå®Œæˆåï¼Œæ ¹æ®ä»»åŠ¡è¯„ä»·ï¼ˆS/A/B/C/Dï¼‰è·å¾—ç»éªŒå€¼å’Œå¯åˆ†é…å±æ€§ç‚¹ã€‚Sçº§è¯„ä»·å¯è·å¾—200ç»éªŒå€¼å’Œ20å±æ€§ç‚¹ï¼ŒAçº§150ç»éªŒå€¼å’Œ15å±æ€§ç‚¹ï¼Œä¾æ­¤ç±»æ¨ã€‚ç»éªŒå€¼å¯ç”¨äºæå‡ç³»ç»Ÿç­‰çº§ï¼Œè§£é”æ›´å¤šåŠŸèƒ½ã€‚å±æ€§ç‚¹å¯ä»¥è‡ªç”±åˆ†é…åˆ°æ‚¨çš„å±æ€§ä¸Šã€‚\n\næ­¤å¤–ï¼Œæ¯ä¸ªä¸–ç•Œéƒ½æœ‰ç‹¬ç‰¹å¥–åŠ±ï¼Œå¯èƒ½æ˜¯ç‰¹æ®ŠæŠ€èƒ½ã€çè´µé“å…·æˆ–ç”·ä¸»èµ äºˆçš„ç‰©å“ã€‚ç´¯è®¡å®Œæˆå¤šä¸ªä¸–ç•Œåï¼Œè¿˜ä¼šæœ‰é¢å¤–æˆå°±å¥–åŠ±ã€‚");
                addOptions([
                    { text: "å¥½çš„ï¼Œæˆ‘æ„¿æ„ç»‘å®š", action: () => confirmBinding() },
                    { text: "å¼€å§‹å§ï¼", action: () => confirmBinding() }
                ]);
            }, 1000);
        }
        
        // è¡¨è¾¾ææƒ§
        function expressFear() {
            addMessage(gameState.playerName, "æˆ‘è¿˜æ˜¯æœ‰ç‚¹å®³æ€•ï¼Œç‰¹åˆ«æ˜¯å°é»‘å±‹æƒ…èŠ‚...");
            setTimeout(() => {
                addMessage(gameState.systemName, "æˆ‘ç†è§£æ‚¨çš„ææƒ§ã€‚å°é»‘å±‹æƒ…èŠ‚ç¡®å®å¯èƒ½å‘ç”Ÿï¼Œä½†å¹¶éæ¯ä¸ªä¸–ç•Œéƒ½ä¼šè§¦å‘ã€‚å³ä½¿è§¦å‘ï¼Œä¹Ÿæ˜¯ç”·ä¸»ç¼ºä¹å®‰å…¨æ„Ÿçš„æç«¯è¡¨ç°ã€‚æ‚¨çš„ä»»åŠ¡æ˜¯è®©ä»–æ˜ç™½ï¼Œå³ä½¿ä¸ç”¨è¿™ç§æ–¹å¼ï¼Œæ‚¨ä¹Ÿä¸ä¼šç¦»å¼€ã€‚\n\nç³»ç»Ÿä¼šæä¾›å¿ƒç†æ”¯æŒå’Œä¿æŠ¤ï¼Œæ‚¨ä¹Ÿå¯ä»¥è´­ä¹°'å®‰å…¨è­¦æŠ¥'é“å…·ï¼Œåœ¨é»‘åŒ–å€¼è¿‡é«˜æ—¶æå‰é¢„è­¦ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œæ‚¨çš„æ€åº¦â€”â€”æ— æ¡ä»¶çš„æ¥çº³å’Œç†è§£ï¼Œæ˜¯åŒ–è§£ç—…å¨‡ç”·ä¸»å¿ƒç»“çš„å…³é”®ã€‚");
                addOptions([
                    { text: "æˆ‘å†³å®šå‹‡æ•¢å°è¯•", action: () => confirmBinding() },
                    { text: "æˆ‘éœ€è¦å†è€ƒè™‘ä¸€ä¸‹", action: () => reconsider() }
                ]);
            }, 1000);
        }
        
        // é‡æ–°è€ƒè™‘
        function reconsider() {
            addMessage(gameState.playerName, "è®©æˆ‘å†æƒ³æƒ³...");
            setTimeout(() => {
                addMessage(gameState.systemName, "å½“ç„¶ï¼Œæ‚¨å¯ä»¥æ…¢æ…¢è€ƒè™‘ã€‚ä½†è¯·è®°ä½ï¼Œæ¯ä¸ªç­‰å¾…æ•‘æ´çš„ç”·ä¸»éƒ½åœ¨ç—›è‹¦ä¸­æŒ£æ‰ï¼Œæ‚¨çš„å†³å®šå¯èƒ½ä¼šæ”¹å˜ä»–ä»¬çš„å‘½è¿ã€‚");
                setTimeout(() => {
                    addMessage(gameState.systemName, "è€ƒè™‘å¥½äº†å—ï¼Ÿ");
                    addOptions([
                        { text: "æˆ‘å‡†å¤‡å¥½äº†ï¼Œç»‘å®šç³»ç»Ÿ", action: () => confirmBinding() },
                        { text: "æˆ‘è¿˜æ˜¯æœ‰ç‚¹çŠ¹è±«", action: () => startGame() }
                    ]);
                }, 1500);
            }, 1000);
        }
        
        // æ˜¾ç¤ºå±æ€§åˆ†é…æ¨¡æ€æ¡†
        function showAttributeModal() {
            attributeModal.style.display = 'flex';
            updateAttributeDisplay();
        }
        
        // æ›´æ–°å±æ€§æ˜¾ç¤º
        function updateAttributeDisplay() {
            const attributeGrid = document.getElementById('attributeGrid');
            const availablePoints = document.getElementById('availablePoints');
            
            attributeGrid.innerHTML = '';
            availablePoints.textContent = gameState.attributePoints;
            
            for (const [attr, value] of Object.entries(gameState.attributes)) {
                const attributeItem = document.createElement('div');
                attributeItem.className = 'attribute-item';
                
                attributeItem.innerHTML = `
                    <div class="attribute-name">${attr}</div>
                    <div class="attribute-controls">
                        <button class="attr-btn" onclick="changeAttribute('${attr}', -5)" ${gameState.attributes[attr] <= 0 ? 'disabled' : ''}>-</button>
                        <div class="attribute-value">${value}</div>
                        <button class="attr-btn" onclick="changeAttribute('${attr}', 5)" ${gameState.attributePoints <= 0 ? 'disabled' : ''}>+</button>
                    </div>
                `;
                
                attributeGrid.appendChild(attributeItem);
            }
        }
        
        // æ›´æ”¹å±æ€§å€¼
        function changeAttribute(attribute, change) {
            if (change < 0 && gameState.attributes[attribute] + change >= 0) {
                gameState.attributes[attribute] += change;
                gameState.attributePoints -= change;
            } else if (change > 0 && gameState.attributePoints - change >= 0) {
                gameState.attributes[attribute] += change;
                gameState.attributePoints -= change;
            }
            updateAttributeDisplay();
        }
        
        // ç¡®è®¤å±æ€§åˆ†é…
        function confirmAttributes() {
            if (gameState.attributePoints > 0) {
                addMessage(gameState.systemName, "æ‚¨è¿˜æœ‰æœªåˆ†é…çš„å±æ€§ç‚¹ï¼Œç¡®å®šè¦è¿™æ ·åˆ†é…å—ï¼Ÿ");
                addOptions([
                    { text: "ç¡®å®šåˆ†é…", action: () => finishAttributeAllocation() },
                    { text: "è¿”å›è°ƒæ•´", action: () => {} }
                ]);
            } else {
                finishAttributeAllocation();
            }
        }
        
        // å®Œæˆå±æ€§åˆ†é…
        function finishAttributeAllocation() {
            attributeModal.style.display = 'none';
            addMessage(gameState.systemName, `å±æ€§åˆ†é…å®Œæˆï¼\næ™ºæ…§: ${gameState.attributes.æ™ºæ…§} | ç¾è²Œ: ${gameState.attributes.ç¾è²Œ} | æ­¦åŠ›: ${gameState.attributes.æ­¦åŠ›} | é­…åŠ›: ${gameState.attributes.é­…åŠ›} | ä½“è´¨: ${gameState.attributes.ä½“è´¨}\n\nç°åœ¨ï¼Œæ‚¨å‡†å¤‡å¥½å¼€å§‹ç¬¬ä¸€ä¸ªä¸–ç•Œçš„ä»»åŠ¡äº†å—ï¼Ÿ`);
            addOptions([
                { text: "å‡†å¤‡å¥½äº†ï¼Œå¼€å§‹ç¬¬ä¸€ä¸ªä¸–ç•Œ", action: () => startWorld(1) },
                { text: "æˆ‘æƒ³å…ˆçœ‹çœ‹å•†åº—", action: () => showShopModal() },
                { text: "æˆ‘æƒ³å†æ£€æŸ¥ä¸€ä¸‹å±æ€§", action: () => showAttributeModal() }
            ]);
        }
        
        // å¼€å§‹ä¸–ç•Œ
        function startWorld(worldId) {
            gameState.currentWorld = worldId;
            gameState.currentScene = 0;
            gameState.triggeredScenes.clear();
            
            const world = worlds.find(w => w.id === worldId);
            if (!world) return;
            
            gameState.currentWorldData = world;
            gameState.worldState = {
                blackValue: world.maleLead.initialValues.black,
                loveValue: world.maleLead.initialValues.love,
                rageValue: world.maleLead.initialValues.rage,
                storyProgress: 0
            };
            
            updateStatusDisplay();
            
            // æ˜¾ç¤ºä¸–ç•Œä»‹ç»
            addMessage(gameState.systemName, `æ­£åœ¨åŠ è½½ä¸–ç•Œ: ${world.title}`);
            setTimeout(() => {
                addMessage(gameState.systemName, `ä¸–ç•ŒèƒŒæ™¯:\n${world.background}\n\næ‚¨çš„èº«ä»½:\n${world.hostIdentity}\n\nç”·ä¸»æ¡£æ¡ˆ:\nå§“å: ${world.maleLead.name}\nå¹´é¾„: ${world.maleLead.age}\nèº«ä»½: ${world.maleLead.identity}\næ€§æ ¼: ${world.maleLead.personality}\n\nåˆå§‹çŠ¶æ€:\né»‘åŒ–å€¼: ${world.maleLead.initialValues.black}\nç‹‚èºå€¼: ${world.maleLead.initialValues.rage}\nå æœ‰æ¬²: ${world.maleLead.initialValues.possession}\nçˆ±æ„å€¼: ${world.maleLead.initialValues.love}\n\nç›®æ ‡:é€šè¿‡æ‚¨çš„é™ªä¼´å’Œæ¥çº³ï¼Œå°†é»‘åŒ–å€¼é™è‡³0ã€‚`);
                
                addOptions([
                    { text: "è¿›å…¥ä¸–ç•Œ", action: () => loadScene("scene1") },
                    { text: "æŸ¥çœ‹ç”·ä¸»è¯¦ç»†æ¡£æ¡ˆ", action: () => showMaleLeadDetails(world) },
                    { text: "æ£€æŸ¥æˆ‘çš„å±æ€§", action: () => showPlayerStatus() }
                ]);
            }, 1500);
        }
        
        // æ˜¾ç¤ºç”·ä¸»è¯¦æƒ…
        function showMaleLeadDetails(world) {
            addMessage(gameState.systemName, `${world.maleLead.name}è¯¦ç»†æ¡£æ¡ˆ:\n\nå®¶åº­èƒŒæ™¯: æ±Ÿæ°é›†å›¢å”¯ä¸€ç»§æ‰¿äººï¼Œçˆ¶æ¯å•†ä¸šè”å§»ï¼Œå…³ç³»å†·æ·¡ã€‚çˆ¶äº²ä¸¥å‰ï¼Œæ¯äº²å¸¸å¹´åœ¨å›½å¤–ã€‚ä»å°è¢«å¯„äºˆåšæœ›ï¼Œæ¥å—ç²¾è‹±æ•™è‚²ï¼Œä½†ç¼ºä¹å®¶åº­æ¸©æš–ã€‚\n\nå¿ƒç†çŠ¶å†µ: æ‚£æœ‰åæ‰§å‹äººæ ¼éšœç¢ï¼Œç¼ºä¹å®‰å…¨æ„Ÿï¼Œå¯¹åœ¨æ„çš„äººæˆ–ç‰©æœ‰æå¼ºçš„å æœ‰æ¬²ã€‚é«˜æ™ºå•†ä½†æƒ…æ„Ÿè¡¨è¾¾éšœç¢ï¼Œä¹ æƒ¯ç”¨å†·æ¼ æ©é¥°å†…å¿ƒçš„ä¸å®‰ã€‚\n\nè§¦å‘ç‚¹: å®³æ€•è¢«æŠ›å¼ƒã€èƒŒå›ï¼Œå¯¹è°è¨€æåº¦æ•æ„Ÿã€‚ä¸€æ—¦è®¤å®šæŸäººï¼Œä¼šäº§ç”Ÿå¼ºçƒˆæ‰§å¿µã€‚\n\nå‰ä¸–ç»“å±€: çˆ±ä¸ŠåŒç­å¥³ç”Ÿæ—å©‰å„¿ï¼Œä½†å¯¹æ–¹æ— æ³•æ¥å—ä»–çš„æ§åˆ¶æ¬²ï¼Œè”åˆåŒå­¦å­¤ç«‹ä»–ï¼Œæœ€ç»ˆå¯¼è‡´ä»–å½»åº•å´©æºƒï¼Œé€ æˆæ— æ³•æŒ½å›çš„æ‚²å‰§ã€‚\n\næ•‘æ²»å…³é”®: éœ€è¦æ— æ¡ä»¶çš„æ¥çº³å’Œé™ªä¼´ï¼Œè®©ä»–ç¡®ä¿¡ä¸ä¼šè¢«æŠ›å¼ƒï¼ŒåŒæ—¶å¼•å¯¼ä»–å­¦ä¼šå¥åº·çš„è¡¨è¾¾æ–¹å¼ã€‚`);
            
            addOptions([
                { text: "è¿›å…¥ä¸–ç•Œ", action: () => loadScene("scene1") },
                { text: "æŸ¥çœ‹æˆ‘çš„çŠ¶æ€", action: () => showPlayerStatus() }
            ]);
        }
        
        // åŠ è½½åœºæ™¯
        function loadScene(sceneId) {
            if (gameState.triggeredScenes.has(sceneId)) {
                // é˜²æ­¢é‡å¤è§¦å‘ç›¸åŒåœºæ™¯
                addMessage(gameState.systemName, "è¯¥å‰§æƒ…èŠ‚ç‚¹å·²ç»è§¦å‘è¿‡ï¼Œè¯·é€‰æ‹©å…¶ä»–è¡ŒåŠ¨ã€‚");
                return;
            }
            
            const world = gameState.currentWorldData;
            const scene = world.scenes.find(s => s.id === sceneId);
            
            if (!scene) {
                // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åœºæ™¯ï¼Œé»˜è®¤æ¨è¿›åˆ°ä¸‹ä¸€ä¸ªåœºæ™¯
                const nextSceneIndex = world.scenes.findIndex(s => s.id === sceneId) + 1;
                if (nextSceneIndex < world.scenes.length) {
                    loadScene(world.scenes[nextSceneIndex].id);
                } else {
                    addMessage(gameState.systemName, "æœ¬ä¸–ç•Œå‰§æƒ…æš‚æ—¶ç»“æŸï¼Œæ›´å¤šå†…å®¹æ­£åœ¨å¼€å‘ä¸­...");
                    addOptions([
                        { text: "è¿”å›ä¸»èœå•", action: () => startGame() },
                        { text: "æŸ¥çœ‹ä»»åŠ¡æ€»ç»“", action: () => showWorldSummary() }
                    ]);
                }
                return;
            }
            
            gameState.triggeredScenes.add(sceneId);
            
            // æ˜¾ç¤ºåœºæ™¯å†…å®¹
            addMessage(gameState.systemName, scene.content);
            
            // å¦‚æœæœ‰é€‰é¡¹ï¼Œæ˜¾ç¤ºé€‰é¡¹
            if (scene.options && scene.options.length > 0) {
                const options = scene.options.map(option => {
                    return {
                        text: option.text,
                        action: () => {
                            // åº”ç”¨æ•ˆæœ
                            if (option.effects) {
                                applyEffects(option.effects);
                            }
                            // åŠ è½½ä¸‹ä¸€ä¸ªåœºæ™¯
                            loadScene(option.next);
                        }
                    };
                });
                
                addOptions(options);
            } else {
                // å¦‚æœæ²¡æœ‰é€‰é¡¹ï¼Œé»˜è®¤ç»§ç»­
                addOptions([
                    { text: "ç»§ç»­", action: () => {
                        const nextSceneIndex = world.scenes.findIndex(s => s.id === sceneId) + 1;
                        if (nextSceneIndex < world.scenes.length) {
                            loadScene(world.scenes[nextSceneIndex].id);
                        }
                    }}
                ]);
            }
            
            // æ›´æ–°ä¸–ç•Œè¿›åº¦
            const sceneIndex = world.scenes.findIndex(s => s.id === sceneId);
            gameState.worldState.storyProgress = Math.min(100, (sceneIndex / world.scenes.length) * 100);
            
            // éšæœºæ›´æ–°ç”·ä¸»çŠ¶æ€
            updateMaleLeadState();
            
            // æ›´æ–°UIæ˜¾ç¤º
            updateStatusDisplay();
        }
        
        // åº”ç”¨é€‰é¡¹æ•ˆæœ
        function applyEffects(effects) {
            if (effects.wisdom) gameState.attributes.æ™ºæ…§ += effects.wisdom;
            if (effects.charm) gameState.attributes.é­…åŠ› += effects.charm;
            if (effects.black) gameState.worldState.blackValue = Math.max(0, Math.min(100, gameState.worldState.blackValue + effects.black));
            if (effects.love) gameState.worldState.loveValue = Math.max(0, Math.min(100, gameState.worldState.loveValue + effects.love));
            if (effects.rage) gameState.worldState.rageValue = Math.max(0, Math.min(100, gameState.worldState.rageValue + effects.rage));
            
            // æ›´æ–°UI
            updateStatusDisplay();
        }
        
        // æ›´æ–°ç”·ä¸»çŠ¶æ€
        function updateMaleLeadState() {
            // æ ¹æ®æ•…äº‹è¿›åº¦å’Œç©å®¶å±æ€§ï¼Œéšæœºæ›´æ–°ç”·ä¸»çŠ¶æ€
            const progressFactor = gameState.worldState.storyProgress / 100;
            const charmFactor = gameState.attributes.é­…åŠ› / 100;
            const wisdomFactor = gameState.attributes.æ™ºæ…§ / 100;
            
            // çˆ±æ„å€¼å¢é•¿
            const loveIncrease = Math.random() * 5 * progressFactor * charmFactor;
            gameState.worldState.loveValue = Math.min(100, gameState.worldState.loveValue + loveIncrease);
            
            // é»‘åŒ–å€¼å’Œç‹‚èºå€¼å¯èƒ½é™ä½ä¹Ÿå¯èƒ½å‡é«˜
            if (Math.random() > 0.7) {
                // æœ‰30%æ¦‚ç‡é»‘åŒ–å€¼å‡é«˜
                const blackIncrease = Math.random() * 3;
                gameState.worldState.blackValue = Math.min(100, gameState.worldState.blackValue + blackIncrease);
            } else {
                // 70%æ¦‚ç‡é»‘åŒ–å€¼é™ä½
                const blackDecrease = Math.random() * 2 * progressFactor * wisdomFactor;
                gameState.worldState.blackValue = Math.max(0, gameState.worldState.blackValue - blackDecrease);
            }
            
            // ç‹‚èºå€¼å˜åŒ–
            if (Math.random() > 0.6) {
                const rageChange = (Math.random() - 0.5) * 4;
                gameState.worldState.rageValue = Math.max(0, Math.min(100, gameState.worldState.rageValue + rageChange));
            }
        }
        
        // æ˜¾ç¤ºç©å®¶çŠ¶æ€
        function showPlayerStatus() {
            statusModal.style.display = 'flex';
            document.getElementById('statusTitle').textContent = `${gameState.playerName}çš„çŠ¶æ€`;
            
            const statusDisplay = document.getElementById('statusDisplay');
            statusDisplay.innerHTML = `
                <div class="character-info">
                    <div class="character-img" style="background: linear-gradient(135deg, #2ed573, #1e90ff);"></div>
                    <div class="character-details">
                        <div class="character-name">${gameState.playerName}</div>
                        <div class="character-desc">ç—…å¨‡ç”·ä¸»è§£æ•‘ç³»ç»Ÿå®¿ä¸»</div>
                    </div>
                </div>
                <div class="message system-message">
                    <div class="message-sender">å±æ€§å€¼</div>
                    <div class="message-content">
                        æ™ºæ…§: ${gameState.attributes.æ™ºæ…§}<br>
                        ç¾è²Œ: ${gameState.attributes.ç¾è²Œ}<br>
                        æ­¦åŠ›: ${gameState.attributes.æ­¦åŠ›}<br>
                        é­…åŠ›: ${gameState.attributes.é­…åŠ›}<br>
                        ä½“è´¨: ${gameState.attributes.ä½“è´¨}
                    </div>
                </div>
            `;
        }
        
        // æ˜¾ç¤ºç”·ä¸»çŠ¶æ€
        function showMaleLeadStatus() {
            statusModal.style.display = 'flex';
            const world = gameState.currentWorldData;
            document.getElementById('statusTitle').textContent = `${world.maleLead.name}çš„çŠ¶æ€`;
            
            const statusDisplay = document.getElementById('statusDisplay');
            statusDisplay.innerHTML = `
                <div class="character-info">
                    <div class="character-img" style="background: linear-gradient(135deg, #8a2be2, #4a1b8c);"></div>
                    <div class="character-details">
                        <div class="character-name">${world.maleLead.name}</div>
                        <div class="character-desc">${world.maleLead.identity}</div>
                    </div>
                </div>
                <div class="status-row">
                    <div class="status-label">é»‘åŒ–å€¼</div>
                    <div class="status-bar-container">
                        <div class="status-bar-fill blackfill" style="width: ${gameState.worldState.blackValue}%"></div>
                    </div>
                    <div class="status-value">${Math.round(gameState.worldState.blackValue)}</div>
                </div>
                <div class="status-row">
                    <div class="status-label">çˆ±æ„å€¼</div>
                    <div class="status-bar-container">
                        <div class="status-bar-fill lovefill" style="width: ${gameState.worldState.loveValue}%"></div>
                    </div>
                    <div class="status-value">${Math.round(gameState.worldState.loveValue)}</div>
                </div>
                <div class="status-row">
                    <div class="status-label">ç‹‚èºå€¼</div>
                    <div class="status-bar-container">
                        <div class="status-bar-fill ragefill" style="width: ${gameState.worldState.rageValue}%"></div>
                    </div>
                    <div class="status-value">${Math.round(gameState.worldState.rageValue)}</div>
                </div>
                <div class="message system-message">
                    <div class="message-sender">å½“å‰çŠ¶æ€åˆ†æ</div>
                    <div class="message-content">
                        ${getStatusAnalysis()}
                    </div>
                </div>
            `;
        }
        
        // è·å–çŠ¶æ€åˆ†æ
        function getStatusAnalysis() {
            const black = gameState.worldState.blackValue;
            const love = gameState.worldState.loveValue;
            const rage = gameState.worldState.rageValue;
            
            if (black > 80) {
                return "è­¦å‘Šï¼šé»‘åŒ–å€¼æé«˜ï¼ç”·ä¸»å¤„äºå±é™©è¾¹ç¼˜ï¼Œå¯èƒ½æœ‰æç«¯è¡Œä¸ºã€‚è¯·è°¨æ…è¡Œäº‹ï¼Œè€ƒè™‘ä½¿ç”¨é•‡é™å‰‚é“å…·ã€‚";
            } else if (black > 60) {
                return "é»‘åŒ–å€¼è¾ƒé«˜ï¼Œç”·ä¸»å¯¹å‘¨å›´ç¯å¢ƒè­¦æƒ•æ€§é«˜ï¼Œå®¹æ˜“äº§ç”Ÿåæ‰§æƒ³æ³•ã€‚éœ€è¦æ›´å¤šå®‰å…¨æ„Ÿã€‚";
            } else if (black > 40) {
                return "é»‘åŒ–å€¼ä¸­ç­‰ï¼Œç”·ä¸»æœ‰ä¸€å®šæˆ’å¤‡å¿ƒç†ï¼Œä½†æ„¿æ„å°è¯•ä¿¡ä»»ã€‚";
            } else if (black > 20) {
                return "é»‘åŒ–å€¼è¾ƒä½ï¼Œç”·ä¸»é€æ¸æ”¾ä¸‹æˆ’å¤‡ï¼Œå¼€å§‹æ¥å—ä½ çš„å­˜åœ¨ã€‚";
            } else {
                return "é»‘åŒ–å€¼å¾ˆä½ï¼Œç”·ä¸»å¿ƒæ€è¾ƒä¸ºå¹³å’Œï¼Œæ²»ç–—è¿›å±•è‰¯å¥½ã€‚";
            }
        }
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatusDisplay() {
            document.getElementById('currentWorld').textContent = gameState.currentWorld;
            document.getElementById('goldAmount').textContent = gameState.gold;
            document.getElementById('expAmount').textContent = gameState.exp;
            document.getElementById('inventoryCount').textContent = gameState.inventory.length;
        }
        
        // æ˜¾ç¤ºå•†åº—
        function showShopModal() {
            shopModal.style.display = 'flex';
            const shopItemsContainer = document.getElementById('shopItems');
            shopItemsContainer.innerHTML = '';
            
            shopItems.forEach(item => {
                const isPurchased = gameState.purchasedItems.includes(item.id);
                const canAfford = gameState.gold >= item.price;
                
                const shopItem = document.createElement('div');
                shopItem.className = 'shop-item';
                shopItem.innerHTML = `
                    <div class="shop-item-info">
                        <div class="shop-item-name">${item.name}</div>
                        <div class="shop-item-desc">${item.description}<br>æ•ˆæœ: ${item.effect}</div>
                    </div>
                    <div class="shop-item-price">${item.price}é‡‘å¸</div>
                    <button class="buy-btn" ${isPurchased || !canAfford ? 'disabled' : ''} onclick="buyItem('${item.id}')">
                        ${isPurchased ? 'å·²è´­ä¹°' : 'è´­ä¹°'}
                    </button>
                `;
                
                shopItemsContainer.appendChild(shopItem);
            });
        }
        
        // è´­ä¹°ç‰©å“
        function buyItem(itemId) {
            const item = shopItems.find(i => i.id === itemId);
            if (!item) return;
            
            if (gameState.gold >= item.price && !gameState.purchasedItems.includes(itemId)) {
                gameState.gold -= item.price;
                gameState.purchasedItems.push(itemId);
                gameState.inventory.push(item);
                
                updateStatusDisplay();
                showShopModal();
                
                addMessage(gameState.systemName, `è´­ä¹°æˆåŠŸï¼è·å¾—${item.name}ã€‚ç‰©å“å·²å­˜å…¥èƒŒåŒ…ã€‚`);
            }
        }
        
        // æ˜¾ç¤ºèƒŒåŒ…
        function showInventoryModal() {
            inventoryModal.style.display = 'flex';
            const inventoryItemsContainer = document.getElementById('inventoryItems');
            inventoryItemsContainer.innerHTML = '';
            
            if (gameState.inventory.length === 0) {
                inventoryItemsContainer.innerHTML = '<div class="message system-message"><div class="message-content">èƒŒåŒ…ç©ºç©ºå¦‚ä¹Ÿï¼Œå»å•†åº—è´­ä¹°é“å…·å§ï¼</div></div>';
                return;
            }
            
            gameState.inventory.forEach((item, index) => {
                const inventoryItem = document.createElement('div');
                inventoryItem.className = 'shop-item';
                inventoryItem.innerHTML = `
                    <div class="shop-item-info">
                        <div class="shop-item-name">${item.name}</div>
                        <div class="shop-item-desc">${item.description}<br>æ•ˆæœ: ${item.effect}</div>
                    </div>
                    <button class="buy-btn" onclick="useItem(${index})">ä½¿ç”¨</button>
                `;
                
                inventoryItemsContainer.appendChild(inventoryItem);
            });
        }
        
        // ä½¿ç”¨ç‰©å“
        function useItem(index) {
            if (index >= 0 && index < gameState.inventory.length) {
                const item = gameState.inventory[index];
                addMessage(gameState.systemName, `ä½¿ç”¨äº†${item.name}ã€‚æ•ˆæœï¼š${item.effect}`);
                
                // æ ¹æ®ç‰©å“æ•ˆæœåº”ç”¨
                if (item.id === "item1") {
                    // å¿ƒçµæ„Ÿåº”ç¬¦ - æ˜¾ç¤ºå‡†ç¡®çŠ¶æ€
                    addMessage(gameState.systemName, `æ±Ÿè¾°å½“å‰å‡†ç¡®çŠ¶æ€ï¼š\né»‘åŒ–å€¼: ${Math.round(gameState.worldState.blackValue)}\nçˆ±æ„å€¼: ${Math.round(gameState.worldState.loveValue)}\nç‹‚èºå€¼: ${Math.round(gameState.worldState.rageValue)}`);
                } else if (item.id === "item3") {
                    // é•‡é™å‰‚ - é™ä½ç‹‚èºå€¼
                    const reduction = 10 + Math.random() * 10;
                    gameState.worldState.rageValue = Math.max(0, gameState.worldState.rageValue - reduction);
                    addMessage(gameState.systemName, `æ±Ÿè¾°çš„ç‹‚èºå€¼é™ä½äº†${Math.round(reduction)}ç‚¹ã€‚`);
                }
                
                // ä»èƒŒåŒ…ç§»é™¤
                gameState.inventory.splice(index, 1);
                gameState.usedItems.push(item.id);
                
                // å…³é—­èƒŒåŒ…ï¼Œæ›´æ–°æ˜¾ç¤º
                inventoryModal.style.display = 'none';
                updateStatusDisplay();
            }
        }
        
        // æ˜¾ç¤ºä¸–ç•Œæ€»ç»“
        function showWorldSummary() {
            addMessage(gameState.systemName, `ä¸–ç•Œä»»åŠ¡æ€»ç»“:\n\nç”·ä¸»: ${gameState.currentWorldData.maleLead.name}\næœ€ç»ˆé»‘åŒ–å€¼: ${Math.round(gameState.worldState.blackValue)}\næœ€ç»ˆçˆ±æ„å€¼: ${Math.round(gameState.worldState.loveValue)}\næ•…äº‹è¿›åº¦: ${Math.round(gameState.worldState.storyProgress)}%\n\næ ¹æ®æ‚¨çš„è¡¨ç°ï¼Œè·å¾—è¯„ä»·: ${getWorldRating()}`);
            
            // è®¡ç®—å¥–åŠ±
            const rating = getWorldRating();
            const rewards = calculateRewards(rating);
            
            addMessage(gameState.systemName, `ä»»åŠ¡å¥–åŠ±:\nç»éªŒå€¼: +${rewards.exp}\nå±æ€§ç‚¹: +${rewards.attributePoints}\né‡‘å¸: +${rewards.gold}\n\n${rewards.specialReward ? 'ç‰¹æ®Šå¥–åŠ±: ' + rewards.specialReward : ''}`);
            
            // åº”ç”¨å¥–åŠ±
            gameState.exp += rewards.exp;
            gameState.attributePoints += rewards.attributePoints;
            gameState.gold += rewards.gold;
            
            updateStatusDisplay();
            
            addOptions([
                { text: "è¿›å…¥ä¸‹ä¸€ä¸ªä¸–ç•Œ", action: () => startWorld(2) },
                { text: "è¿”å›ç³»ç»Ÿç©ºé—´", action: () => returnToSystem() },
                { text: "æŸ¥çœ‹æˆ‘çš„çŠ¶æ€", action: () => showPlayerStatus() }
            ]);
        }
        
        // è·å–ä¸–ç•Œè¯„ä»·
        function getWorldRating() {
            const black = gameState.worldState.blackValue;
            const love = gameState.worldState.loveValue;
            const progress = gameState.worldState.storyProgress;
            
            if (black <= 20 && love >= 80 && progress >= 80) return "S";
            if (black <= 40 && love >= 60 && progress >= 60) return "A";
            if (black <= 60 && love >= 40 && progress >= 40) return "B";
            if (black <= 80 && love >= 20 && progress >= 20) return "C";
            return "D";
        }
        
        // è®¡ç®—å¥–åŠ±
        function calculateRewards(rating) {
            const rewards = {
                S: { exp: 200, attributePoints: 20, gold: 200, specialReward: "æ±Ÿè¾°çš„æ€€è¡¨ï¼ˆå¯æŸ¥çœ‹æ—¶é—´çº¿ï¼‰" },
                A: { exp: 150, attributePoints: 15, gold: 150, specialReward: "å­¦éœ¸ç¬”è®°ï¼ˆæ™ºæ…§+5æ°¸ä¹…ï¼‰" },
                B: { exp: 100, attributePoints: 10, gold: 100, specialReward: "æ ¡å›­å¾½ç« ï¼ˆé­…åŠ›+3æ°¸ä¹…ï¼‰" },
                C: { exp: 50, attributePoints: 5, gold: 50, specialReward: "çºªå¿µç…§ç‰‡" },
                D: { exp: 20, attributePoints: 2, gold: 20, specialReward: null }
            };
            
            return rewards[rating] || rewards.D;
        }
        
        // è¿”å›ç³»ç»Ÿç©ºé—´
        function returnToSystem() {
            addMessage(gameState.systemName, "æ¬¢è¿å›åˆ°ç³»ç»Ÿç©ºé—´ï¼æ‚¨å·²å®Œæˆä¸€ä¸ªä¸–ç•Œçš„ä»»åŠ¡ã€‚æ˜¯å¦è¦åˆ†é…è·å¾—çš„å±æ€§ç‚¹ï¼Ÿ");
            addOptions([
                { text: "åˆ†é…å±æ€§ç‚¹", action: () => showAttributeModal() },
                { text: "è¿›å…¥ä¸‹ä¸€ä¸ªä¸–ç•Œ", action: () => startWorld(gameState.currentWorld + 1) },
                { text: "æŸ¥çœ‹å•†åº—", action: () => showShopModal() },
                { text: "æŸ¥çœ‹ä»»åŠ¡æ€»ç»“", action: () => showWorldSummary() }
            ]);
        }
        
        // æ·»åŠ æ¶ˆæ¯åˆ°å†…å®¹åŒºåŸŸ
        function addMessage(sender, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === gameState.systemName ? 'message system-message' : 'message player-message';
            
            messageDiv.innerHTML = `
                <div class="message-sender">${sender}</div>
                <div class="message-content">${content.replace(/\n/g, '<br>')}</div>
            `;
            
            contentArea.appendChild(messageDiv);
            contentArea.scrollTop = contentArea.scrollHeight;
        }
        
        // æ·»åŠ é€‰é¡¹
        function addOptions(options) {
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'options-container';
            
            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = option.text;
                button.onclick = option.action;
                optionsContainer.appendChild(button);
            });
            
            contentArea.appendChild(optionsContainer);
            contentArea.scrollTop = contentArea.scrollHeight;
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('closeAttributeModal').addEventListener('click', () => {
            attributeModal.style.display = 'none';
        });
        
        document.getElementById('confirmAttributes').addEventListener('click', confirmAttributes);
        
        document.getElementById('closeStatusModal').addEventListener('click', () => {
            statusModal.style.display = 'none';
        });
        
        document.getElementById('closeShopModal').addEventListener('click', () => {
            shopModal.style.display = 'none';
        });
        
        document.getElementById('closeInventoryModal').addEventListener('click', () => {
            inventoryModal.style.display = 'none';
        });
        
        document.getElementById('closeMenuModal').addEventListener('click', () => {
            menuModal.style.display = 'none';
        });
        
        document.getElementById('profileBtn').addEventListener('click', () => {
            if (gameState.currentWorldData) {
                showMaleLeadStatus();
            } else {
                showPlayerStatus();
            }
        });
        
        document.getElementById('shopBtn').addEventListener('click', showShopModal);
        
        document.getElementById('inventoryBtn').addEventListener('click', showInventoryModal);
        
        document.getElementById('menuBtn').addEventListener('click', () => {
            menuModal.style.display = 'flex';
        });
        
        // èœå•é€‰é¡¹
        document.getElementById('saveGameBtn').addEventListener('click', () => {
            try {
                localStorage.setItem('bingjiaoSave', JSON.stringify(gameState));
                addMessage(gameState.systemName, "æ¸¸æˆå·²ä¿å­˜ï¼");
                menuModal.style.display = 'none';
            } catch (e) {
                addMessage(gameState.systemName, "ä¿å­˜å¤±è´¥: " + e.message);
            }
        });
        
        document.getElementById('loadGameBtn').addEventListener('click', () => {
            try {
                const saved = localStorage.getItem('bingjiaoSave');
                if (saved) {
                    const savedState = JSON.parse(saved);
                    Object.assign(gameState, savedState);
                    updateStatusDisplay();
                    addMessage(gameState.systemName, "æ¸¸æˆå·²è¯»å–ï¼");
                    menuModal.style.display = 'none';
                    
                    // å›åˆ°å½“å‰åœºæ™¯
                    if (gameState.currentWorld > 0) {
                        addMessage(gameState.systemName, `å›åˆ°ä¸–ç•Œ${gameState.currentWorld}ï¼Œç»§ç»­ä»»åŠ¡ã€‚`);
                        startWorld(gameState.currentWorld);
                    }
                } else {
                    addMessage(gameState.systemName, "æ²¡æœ‰æ‰¾åˆ°ä¿å­˜æ–‡ä»¶ã€‚");
                }
            } catch (e) {
                addMessage(gameState.systemName, "è¯»å–å¤±è´¥: " + e.message);
            }
        });
        
        document.getElementById('restartGameBtn').addEventListener('click', () => {
            if (confirm("ç¡®å®šè¦é‡æ–°å¼€å§‹æ¸¸æˆå—ï¼Ÿæ‰€æœ‰è¿›åº¦éƒ½å°†ä¸¢å¤±ã€‚")) {
                location.reload();
            }
        });
        
        document.getElementById('helpBtn').addEventListener('click', () => {
            addMessage(gameState.systemName, "æ¸¸æˆå¸®åŠ©:\n\n1. ç‚¹å‡»é€‰é¡¹æ¨è¿›å‰§æƒ…ï¼Œæ‚¨çš„é€‰æ‹©ä¼šå½±å“ç”·ä¸»çŠ¶æ€å’Œå‰§æƒ…èµ°å‘ã€‚\n2. ç‚¹å‡»ä¸‹æ–¹å›¾æ ‡å¯ä»¥æŸ¥çœ‹çŠ¶æ€ã€å•†åº—ã€èƒŒåŒ…å’Œèœå•ã€‚\n3. æ¯ä¸ªä¸–ç•Œéœ€è¦å°†ç”·ä¸»çš„é»‘åŒ–å€¼é™è‡³0æ‰èƒ½å®Œæˆä»»åŠ¡ã€‚\n4. é‡‘å¸å¯ä»¥è´­ä¹°é“å…·ï¼Œé“å…·å¯ä»¥å¸®åŠ©æ‚¨æ›´å¥½åœ°å®Œæˆä»»åŠ¡ã€‚\n5. å±æ€§ç‚¹å½±å“æ‚¨åœ¨å‰§æƒ…ä¸­çš„è¡¨ç°ï¼Œè¯·åˆç†åˆ†é…ã€‚");
            menuModal.style.display = 'none';
        });
        
        document.getElementById('aboutBtn').addEventListener('click', () => {
            addMessage(gameState.systemName, "ç—…å¨‡ç”·ä¸»è§£æ•‘ç³»ç»Ÿ v1.0\n\nä¸€æ¬¾åŸºäºå¿«ç©¿é¢˜æçš„äº’åŠ¨æ¸¸æˆã€‚æ‚¨å°†æ‰®æ¼”å®¿ä¸»æ³—å¦ï¼Œç©¿è¶Šä¸åŒä¸–ç•Œï¼Œè§£æ•‘è¢«åŸä¸–ç•Œå«Œå¼ƒæŠ›å¼ƒçš„ç—…å¨‡ç”·ä¸»ã€‚é€šè¿‡ç†è§£ã€æ¥çº³å’Œåšå®šçš„é€‰æ‹©ï¼Œå¸®åŠ©ä»–ä»¬é™ä½é»‘åŒ–å€¼ï¼Œèµ°å‘æ­£å¸¸ç”Ÿæ´»ã€‚\n\næ¯ä¸ªä¸–ç•Œéƒ½æœ‰ç‹¬ç‰¹çš„æ•…äº‹å’Œç”·ä¸»ï¼Œæ‚¨çš„é€‰æ‹©å°†å†³å®šä»–ä»¬çš„å‘½è¿ã€‚");
            menuModal.style.display = 'none';
        });
        
        // åˆå§‹åŒ–
        window.onload = initGame;
        
        // å…¨å±€å‡½æ•°
        window.changeAttribute = changeAttribute;
        window.buyItem = buyItem;
        window.useItem = useItem;
    </script>
</body>
</html>